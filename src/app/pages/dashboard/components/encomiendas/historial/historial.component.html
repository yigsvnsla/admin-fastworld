
<ion-header>
  <ion-toolbar>
    <app-btn-menu slot="start"></app-btn-menu>
    <ion-buttons slot="end">
      <ion-menu-button menu="menu-historial"></ion-menu-button>
    </ion-buttons>
    <ion-title>Historial Encomiendas</ion-title>
  </ion-toolbar>
</ion-header>

<app-menu-filter></app-menu-filter>

<ion-content>
  <ngx-datatable
    class="dark fullscreen"
    [rows]="this.source"
    [columnMode]="this.ColumnMode.standard"
    [headerHeight]="this.headerHeight"
    [rowHeight]="this.rowHeight"
    [loadingIndicator]="this.loading"
    [scrollbarV]="true"
    (scroll)="this.onScroll($event.offsetY)"
    [reorderable]="false"
    [swapColumns]="false"> 

  <ngx-datatable-column 
    [canAutoResize]="true"
    [resizeable]="false"
    [draggable]="false" 
    [sortable]="false" 
    name="id"  
    prop="id">
    <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }}</ng-template>
    <ng-template let-row="row" let-value="value"  ngx-datatable-cell-template let-rowIndex="rowIndex">{{value}}</ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column 
  [canAutoResize]="true"
  [resizeable]="false"
  [draggable]="false" 
  [sortable]="false" 
  name="Categoria"  
  prop="attributes.category">
  <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }}</ng-template>
  <ng-template let-row="row" let-value="value" ngx-datatable-cell-template let-rowIndex="rowIndex">{{value}}</ng-template>
</ngx-datatable-column>

  <ngx-datatable-column 
    [canAutoResize]="true"
    [resizeable]="false"
    [draggable]="false" 
    [sortable]="false" 
    name="Remitente"
    prop="attributes.sender.data.attributes.basic.data">
    <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }} </ng-template>
    <ng-template let-row="row" let-value="value"  ngx-datatable-cell-template let-rowIndex="rowIndex">
      <ion-label [id]="'sender'+'-'+rowIndex" style="cursor: pointer;">{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</ion-label>
      <ion-popover 
      side="left" 
      alignment="center" 
      [showBackdrop]="true" 
      reference="event"
      [trigger]="'sender'+'-'+rowIndex"
      triggerAction="click"
      style="--offset-y: -65px">
        <ng-template>
          <ion-content>
            <ion-card>
              <ion-card-header class="ion-no-padding">
                <ion-item>
                  <ion-label position="stacked" style="display: flex; align-items: center;">
                    <ion-icon name="person"></ion-icon>
                    <ion-text color="orange">Cliente: {{value.id}}</ion-text>
                  </ion-label>
                  <h4>{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</h4>
                </ion-item>
              </ion-card-header>
              <ion-card-header class="ion-no-padding">
              <ion-card-subtitle  style="display: flex; align-items: center; justify-content: center;">
                <ion-fab-button color="orange" size="small">
                  <ion-icon name="search"></ion-icon>
                </ion-fab-button>
                <ion-fab-button href="tel:{{0}}" size="small">
                  <ion-icon name="call"></ion-icon>
                </ion-fab-button>
                <ion-fab-button  target="_blank" rel="noopener noreferrer" color="success" size="small">
                  <ion-icon name="logo-whatsapp"></ion-icon>
                </ion-fab-button>
              </ion-card-subtitle>
            </ion-card-header>
            </ion-card>
          </ion-content>
        </ng-template>
      </ion-popover>
    </ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column 
    [canAutoResize]="true"
    [resizeable]="false"
    [draggable]="false" 
    [sortable]="false" 
    name="Conductor"
    prop="attributes.sender.data.attributes.basic.data">
    <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }} </ng-template>
    <ng-template let-row="row" let-value="value"  ngx-datatable-cell-template let-rowIndex="rowIndex">
      <ion-label [id]="'driver'+'-'+rowIndex" style="cursor: pointer;">{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</ion-label>
      <ion-popover 
      side="left" 
      alignment="center" 
      [showBackdrop]="true" 
      reference="event"
      [trigger]="'driver'+'-'+rowIndex" 
      triggerAction="click"
      style="--offset-y: -65px">
        <ng-template>
          <ion-content>
            <ion-card>
              <ion-card-header class="ion-no-padding">
                <ion-item>
                  <ion-label position="stacked" style="display: flex; align-items: center;">
                    <ion-icon name="person"></ion-icon>
                    <ion-text color="orange">Cliente: {{value.id}}</ion-text>
                  </ion-label>
                  <h4>{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</h4>
                </ion-item>
              </ion-card-header>
              <ion-card-header class="ion-no-padding">
              <ion-card-subtitle  style="display: flex; align-items: center; justify-content: center;">
                <ion-fab-button color="orange" size="small">
                  <ion-icon name="search"></ion-icon>
                </ion-fab-button>
                <ion-fab-button href="tel:{{0}}" size="small">
                  <ion-icon name="call"></ion-icon>
                </ion-fab-button>
                <ion-fab-button  target="_blank" rel="noopener noreferrer" color="success" size="small">
                  <ion-icon name="logo-whatsapp"></ion-icon>
                </ion-fab-button>
              </ion-card-subtitle>
            </ion-card-header>
            </ion-card>
          </ion-content>
        </ng-template>
      </ion-popover>
    </ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column 
  [canAutoResize]="true"
  [resizeable]="false"
  [draggable]="false" 
  [sortable]="false" 
  name="Destinatario"
  prop="attributes.sender.data.attributes.basic.data">
  <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }} </ng-template>
  <ng-template let-row="row" let-value="value"  ngx-datatable-cell-template let-rowIndex="rowIndex">
  <ion-label [id]="'receiver'+'-'+rowIndex" style="cursor: pointer;">{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</ion-label>
  <ion-popover 
  side="left" 
  alignment="center" 
  [showBackdrop]="true" 
  reference="event"
  [trigger]="'receiver'+'-'+rowIndex"
  triggerAction="click"
  style="--offset-y: -65px">
  <ng-template>
  <ion-content>
    <ion-card>
      <ion-card-header class="ion-no-padding">
        <ion-item>
          <ion-label position="stacked" style="display: flex; align-items: center;">
            <ion-icon name="person"></ion-icon>
            <ion-text color="orange">Cliente: {{value.id}}</ion-text>
          </ion-label>
          <h4>{{(value.attributes.name | titlecase)}} {{(value.attributes.lastname | titlecase)}}</h4>
        </ion-item>
      </ion-card-header>
      <ion-card-header class="ion-no-padding">
      <ion-card-subtitle  style="display: flex; align-items: center; justify-content: center;">
        <ion-fab-button color="orange" size="small">
          <ion-icon name="search"></ion-icon>
        </ion-fab-button>
        <ion-fab-button href="tel:{{0}}" size="small">
          <ion-icon name="call"></ion-icon>
        </ion-fab-button>
        <ion-fab-button  target="_blank" rel="noopener noreferrer" color="success" size="small">
          <ion-icon name="logo-whatsapp"></ion-icon>
        </ion-fab-button>
      </ion-card-subtitle>
    </ion-card-header>
    </ion-card>
  </ion-content>
  </ng-template>
  </ion-popover>
  </ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column 
  [canAutoResize]="true"
  [resizeable]="false"
  [draggable]="false" 
  [sortable]="false" 
  name="Fecha de CreaciÃ³n"  
  prop="attributes.createdAt">
  <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }}</ng-template>
  <ng-template let-row="row" let-value="value"  ngx-datatable-cell-template let-rowIndex="rowIndex">{{(value | date:'short')}}</ng-template>
</ngx-datatable-column>

  <!-- Options -->
  <ngx-datatable-column
      headerClass="center"
      cellClass="center"
      [width]="225"
      [canAutoResize]="true"
      [resizeable]="false"
      [draggable]="false" 
      [sortable]="false" 
      name="Opciones"  
      prop="id">
      <ng-template let-column="column" ngx-datatable-header-template>{{ column.name }} </ng-template>
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
        <ion-fab-button (click)="this.onSearchPackage(value)" color="orange"  size="small">
          <ion-icon name="search"></ion-icon>
        </ion-fab-button>
        <ion-fab-button (click)="this.onTransferPackage(value)" color="primary"  size="small">
          <ion-icon name="repeat"></ion-icon>
        </ion-fab-button>
        <ion-fab-button (click)="this.onDonwloadInfoPackage(value)" color="success"  size="small">
          <ion-icon name="cloud-download"></ion-icon>
        </ion-fab-button>
        <ion-fab-button (click)="this.onDeletePackage(value)" color="danger" size="small">
          <ion-icon name="close"></ion-icon>
        </ion-fab-button> 
      </ng-template>
  </ngx-datatable-column>
</ngx-datatable>
</ion-content>
